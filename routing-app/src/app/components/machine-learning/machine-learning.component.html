<div>    
    <app-toolbar currentPageTitle="Machine Learning" previousLink="/analysis" nextLink="/results"></app-toolbar>
</div>

<div style="padding: 20px; display:flex;">

	<button mat-raised-button [matMenuTriggerFor]="animals">Select ML algorithm</button>
	<mat-menu #animals="matMenu">
		<button mat-menu-item [matMenuTriggerFor]="regression">Regression</button>
		<button mat-menu-item [matMenuTriggerFor]="classification">Classification</button>
	</mat-menu>

	<mat-menu #regression="matMenu">
		<button mat-menu-item (click)="onSelectAlgo('Linear Regression', 'linear_regr')">Linear Regression</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - Decision Trees', 'decision_trees_regr')">Decision Trees</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - K-Nearest Neighbours (KNN)', 'knn_regr')">K-Nearest Neighbours (KNN)</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - Support Vector Machines (SVM)', 'svm_regr')">Support Vector Machines (SVM)</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - Random Forest', 'random_forest_regr')">Random Forest</button>
		<button mat-menu-item [matMenuTriggerFor]="regression_ensemble">Ensemble</button>
	</mat-menu>

	<mat-menu #classification="matMenu">
		<button disabled mat-menu-item>None</button>
	</mat-menu>
	
	<mat-menu #regression_ensemble="matMenu">
		<button mat-menu-item (click)="onSelectAlgo('Regr - Bagging', 'bagging_regr')">Bagging</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - Random Forest', 'random_forest_regr')">Random Forest</button>
		<button mat-menu-item (click)="onSelectAlgo('Regr - Voting', 'voting_regr')">Voting</button>
	</mat-menu>

	<span style="padding: 10px;" *ngIf="selectedAlgoId">{{selectedAlgoName}}</span>

	<!-- <mat-form-field appearance="fill">
		<mat-label>Select algorithm category</mat-label>
		<mat-select [(value)]="algorithmCategory" (selectionChange)="selectCategory()">
			<mat-option value="Classification">Classification</mat-option>
			<mat-option value="Regression">Regression</mat-option>
		</mat-select>
	</mat-form-field>
	<mat-form-field appearance="fill" style="margin: 5px" *ngIf="algorithmCategory">
		<mat-label>Select {{algorithmCategory}} algorithm</mat-label>
		<mat-select [(value)]="selectedAlgorithmId" (selectionChange)="algorithmChange()">
			<mat-option *ngFor="let algorithm of algorithms" [value]="algorithm.id">
				{{algorithm.name}}
			</mat-option>
		</mat-select>
	</mat-form-field> -->
	<span class="flex-spacer"></span>
	<button mat-raised-button color="accent" (click)="runAlgorithm()">RUN</button>
</div>

<mat-accordion multi>
	<mat-expansion-panel>
		<mat-expansion-panel-header>
			<mat-panel-title>
				Attribute selection
			</mat-panel-title>
			<mat-panel-description>
				Select attributes to be inlcuded in training model
			</mat-panel-description>
		</mat-expansion-panel-header>
		<section>
			<div>
				Specify target variable
			</div>
			<mat-form-field appearance="fill">
				<mat-label>Target Variable</mat-label>
				<mat-select (selectionChange)="onSelectTarget()" [(value)]="targetVariable">
					<mat-option *ngFor="let variable of variables" [value]="variable">
						{{variable}}
					</mat-option>
				</mat-select>
			</mat-form-field>
			<section>
				<div>Select independent variables </div>
				<div *ngIf="targetVariable;else noTargetSelected">
					<mat-checkbox [checked]="allSelected" [indeterminate]="someSelected()"
						(change)="setAll($event.checked)">
						Select All
					</mat-checkbox>
					<ul>
						<li *ngFor="let variable of independentVariables">
							<mat-checkbox [(ngModel)]="variable.selected" (ngModelChange)="updateAllSelected()">
								{{variable.name}}
							</mat-checkbox>
						</li>
					</ul>
				</div>
				<ng-template #noTargetSelected>Select a target variable to proceed</ng-template>
				
			</section>
		</section>
	</mat-expansion-panel>
	<!-- <mat-expansion-panel>
		<mat-expansion-panel-header>
			<mat-panel-title>
				Algorithm specific parameters
			</mat-panel-title>
			<mat-panel-description>
				Set additional parameters of the machine learning algorithm
			</mat-panel-description>
		</mat-expansion-panel-header>
		<div>
			<form #myForm="ngForm">
				<div *ngFor="let field of additionalParamsFormFields">
					<mat-form-field>
						<mat-label>{{ field.label }}</mat-label>
						<ng-container [ngSwitch]="field.type">
							<input *ngSwitchCase="'text'" matInput type="text" [placeholder]="field.label"
								[id]="field.name" [name]="field.name" [(ngModel)]="additionalParamsFormData[field.name]"
								[required]="field.required">
							<input *ngSwitchCase="'number'" matInput type="number" [placeholder]="field.label"
								[id]="field.name" [name]="field.name" [(ngModel)]="additionalParamsFormData[field.name]"
								[required]="field.required" [min]="field.min" [max]="field.max" [step]="field.step">
							<input *ngSwitchCase="'email'" matInput [placeholder]="field.label" [id]="field.name"
								[name]="field.name" [(ngModel)]="additionalParamsFormData[field.name]" [required]="field.required">
							<textarea *ngSwitchCase="'textarea'" matInput [placeholder]="field.label" [id]="field.name"
								[name]="field.name" [(ngModel)]="additionalParamsFormData[field.name]"
								[required]="field.required"></textarea>
						</ng-container>
					</mat-form-field>
				</div>
			</form>
		</div>
	</mat-expansion-panel> -->
	<mat-expansion-panel>
		<mat-expansion-panel-header>
			<mat-panel-title>
				Algorithm specific parameters
			</mat-panel-title>
			<mat-panel-description>
				Set additional parameters of the machine learning algorithm
			</mat-panel-description>
		</mat-expansion-panel-header>
		<div [ngSwitch]="selectedAlgoId">
			<app-regr-decision-trees-params *ngSwitchCase="'decision_trees_regr'" (valueChange)="onParamsChange($event)"></app-regr-decision-trees-params>
			<app-regr-knn-params *ngSwitchCase="'knn_regr'" (valueChange)="onParamsChange($event)"></app-regr-knn-params> 
			<app-regr-random-forest-params *ngSwitchCase="'random_forest_regr'" (valueChange)="onParamsChange($event)"></app-regr-random-forest-params>
		</div>
	</mat-expansion-panel>
	<mat-expansion-panel>
		<mat-expansion-panel-header>
			<mat-panel-title>
				Result logging Information
			</mat-panel-title>
			<mat-panel-description>
				Configure the logging of results
			</mat-panel-description>
		</mat-expansion-panel-header>
		<div style="padding: 10px;">
			<form [formGroup]="resultLogForm">
				<mat-form-field>
					<mat-label>Run Name</mat-label>
					<input matInput type="text" formControlName="runName">
				</mat-form-field>
			</form>
		</div>
	</mat-expansion-panel>
</mat-accordion>




<mat-divider></mat-divider>
<br>

<h2>Results:</h2>
<div *ngIf="results">
	<div *ngIf="selectedAlgoId == 'linear_regr'">
		<p>Coefficients:</p>
		<ul>
			<li *ngFor="let coefficient of results.Coefficients">{{ coefficient }}</li>
		</ul>
		<p>Intercept: {{ results.Intercept }}</p>
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>

	<div *ngIf="selectedAlgoId == 'svm_regr'">
		<p>Coefficients:</p>
		<ul>
			<li *ngFor="let coefficient of results.Coefficients">{{ coefficient }}</li>
		</ul>
		<p>Intercept: {{ results.Intercept }}</p>
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>

	<div *ngIf="selectedAlgoId == 'decision_trees_regr'">
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>

	<div *ngIf="selectedAlgoId == 'knn_regr'">
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>

	<div *ngIf="selectedAlgoId == 'random_forest_regr'">
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>

	<div *ngIf="selectedAlgoId == 'voting_regr'">
		<p>Mean Absolute Error (MAE): {{ results.mae }}</p>
		<p>Mean Squared Error (MSE): {{ results.mse }}</p>
		<p>Root Mean Squared Error (RMSE): {{ results.rmse }}</p>
		<p>Mean Absolute Percentage: {{ results.mean_absolute_percentage }}</p>
		<p>Max Error: {{ results.max_error }}</p>
		<p>R2 Score: {{ results.r2_score }}</p>
	</div>
</div>